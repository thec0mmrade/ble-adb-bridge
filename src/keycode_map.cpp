#include "keycode_map.h"

namespace keycode_map {

// USB HID Usage Page 0x07 → ADB 7-bit keycode.
// 0xFF = no mapping.
// Based on QuokkADB usbtoadb.cpp and Apple ADB keyboard technical reference.
static const uint8_t USB_TO_ADB[256] = {
    // 0x00–0x03: Reserved/Error
    0xFF, 0xFF, 0xFF, 0xFF,

    // 0x04–0x1D: Letters A–Z
    0x00, // 0x04 A
    0x0B, // 0x05 B
    0x08, // 0x06 C
    0x02, // 0x07 D
    0x0E, // 0x08 E
    0x03, // 0x09 F
    0x05, // 0x0A G
    0x04, // 0x0B H
    0x22, // 0x0C I
    0x26, // 0x0D J
    0x28, // 0x0E K
    0x25, // 0x0F L
    0x2E, // 0x10 M
    0x2D, // 0x11 N
    0x1F, // 0x12 O
    0x23, // 0x13 P
    0x0C, // 0x14 Q
    0x0F, // 0x15 R
    0x01, // 0x16 S
    0x11, // 0x17 T
    0x20, // 0x18 U
    0x09, // 0x19 V
    0x0D, // 0x1A W
    0x07, // 0x1B X
    0x10, // 0x1C Y
    0x06, // 0x1D Z

    // 0x1E–0x27: Numbers 1–0
    0x12, // 0x1E 1
    0x13, // 0x1F 2
    0x14, // 0x20 3
    0x15, // 0x21 4
    0x17, // 0x22 5
    0x16, // 0x23 6
    0x1A, // 0x24 7
    0x1C, // 0x25 8
    0x19, // 0x26 9
    0x1D, // 0x27 0

    // 0x28–0x2C: Enter, Escape, Backspace, Tab, Space
    0x24, // 0x28 Enter
    0x35, // 0x29 Escape
    0x33, // 0x2A Backspace
    0x30, // 0x2B Tab
    0x31, // 0x2C Space

    // 0x2D–0x38: Punctuation and symbols
    0x1B, // 0x2D - (minus)
    0x18, // 0x2E = (equals)
    0x21, // 0x2F [ (left bracket)
    0x1E, // 0x30 ] (right bracket)
    0x2A, // 0x31 \ (backslash)
    0x2A, // 0x32 # (non-US, same as backslash)
    0x29, // 0x33 ; (semicolon)
    0x27, // 0x34 ' (apostrophe)
    0x32, // 0x35 ` (grave accent)
    0x2B, // 0x36 , (comma)
    0x2F, // 0x37 . (period)
    0x2C, // 0x38 / (slash)

    // 0x39: Caps Lock
    0x39, // 0x39 Caps Lock

    // 0x3A–0x45: F1–F12
    0x7A, // 0x3A F1
    0x78, // 0x3B F2
    0x63, // 0x3C F3
    0x76, // 0x3D F4
    0x60, // 0x3E F5
    0x61, // 0x3F F6
    0x62, // 0x40 F7
    0x64, // 0x41 F8
    0x65, // 0x42 F9
    0x6D, // 0x43 F10
    0x67, // 0x44 F11
    0x6F, // 0x45 F12

    // 0x46–0x48: Print Screen, Scroll Lock, Pause
    0x69, // 0x46 Print Screen (→ F13)
    0x6B, // 0x47 Scroll Lock (→ F14)
    0x71, // 0x48 Pause (→ F15)

    // 0x49–0x4C: Insert, Home, Page Up, Delete
    0x72, // 0x49 Insert (→ Help on Mac)
    0x73, // 0x4A Home
    0x74, // 0x4B Page Up
    0x75, // 0x4C Delete Forward

    // 0x4D–0x4E: End, Page Down
    0x77, // 0x4D End
    0x79, // 0x4E Page Down

    // 0x4F–0x52: Arrow keys (ADB wire scan codes, NOT Mac virtual keycodes)
    0x3C, // 0x4F Right Arrow
    0x3B, // 0x50 Left Arrow
    0x3D, // 0x51 Down Arrow
    0x3E, // 0x52 Up Arrow

    // 0x53: Num Lock
    0x47, // 0x53 Num Lock (→ Clear on Mac)

    // 0x54–0x63: Keypad
    0x4B, // 0x54 KP /
    0x43, // 0x55 KP *
    0x4E, // 0x56 KP -
    0x45, // 0x57 KP +
    0x4C, // 0x58 KP Enter
    0x53, // 0x59 KP 1
    0x54, // 0x5A KP 2
    0x55, // 0x5B KP 3
    0x56, // 0x5C KP 4
    0x57, // 0x5D KP 5
    0x58, // 0x5E KP 6
    0x59, // 0x5F KP 7
    0x5B, // 0x60 KP 8
    0x5C, // 0x61 KP 9
    0x52, // 0x62 KP 0
    0x41, // 0x63 KP .

    // 0x64: Non-US backslash
    0x0A, // 0x64 Non-US \ (ISO key)

    // 0x65: Application (Menu key)
    0x6E, // 0x65 Application (→ Mac context menu / Power key)

    // 0x66: Power
    0x7F, // 0x66 Power

    // 0x67: KP =
    0x51, // 0x67 KP =

    // 0x68–0x73: F13–F24
    0x69, // 0x68 F13
    0x6B, // 0x69 F14
    0x71, // 0x6A F15
    0xFF, // 0x6B F16
    0xFF, // 0x6C F17
    0xFF, // 0x6D F18
    0xFF, // 0x6E F19
    0xFF, // 0x6F F20
    0xFF, // 0x70 F21
    0xFF, // 0x71 F22
    0xFF, // 0x72 F23
    0xFF, // 0x73 F24

    // 0x74–0x86: Various
    0xFF, // 0x74 Execute
    0xFF, // 0x75 Help
    0xFF, // 0x76 Menu
    0xFF, // 0x77 Select
    0xFF, // 0x78 Stop
    0xFF, // 0x79 Again
    0xFF, // 0x7A Undo
    0xFF, // 0x7B Cut
    0xFF, // 0x7C Copy
    0xFF, // 0x7D Paste
    0xFF, // 0x7E Find
    0xFF, // 0x7F Mute
    0xFF, // 0x80 Volume Up
    0xFF, // 0x81 Volume Down
    0xFF, // 0x82 Locking Caps
    0xFF, // 0x83 Locking Num
    0xFF, // 0x84 Locking Scroll
    0xFF, // 0x85 KP Comma
    0xFF, // 0x86 KP Equal AS/400

    // 0x87–0x94: International
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,

    // 0x95–0x9F: Reserved
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF,

    // 0xA0–0xDF: Various language/reserved (unmapped)
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,

    // 0xE0–0xE7: Modifier keys (handled separately via modifier byte)
    // Left Ctrl, Left Shift, Left Alt, Left GUI,
    // Right Ctrl, Right Shift, Right Alt, Right GUI
    // Note: Right modifiers use ADB wire scan codes (0x7B-0x7D), NOT arrow codes (0x3B-0x3E)
    0x36, 0x38, 0x3A, 0x37, 0x7D, 0x7B, 0x7C, 0x37,

    // 0xE8–0xFF: Reserved
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
};

uint8_t usb_to_adb(uint8_t usb_keycode) {
    return USB_TO_ADB[usb_keycode];
}

} // namespace keycode_map
